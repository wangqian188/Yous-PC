<style lang="less">

</style>


<template>

    <div class="screening_conts_detail pv20">
        <div class="screening_conts_list weizhi clearfix tj_box_1" @click="getStation($event)">
            <span class="screening_title mr15">位置:</span>
            <Progress :percent="statusbar" :stroke-width="5" status="active" v-show="statusShow"></Progress>
            <a href="javascript:;"
               v-for="(item,index) in lines"
               :class="[{active:line_active == index},item.class]"
               :id="item.id"
               :data-sortType="'sort_sub_lin_'+index"
            >{{item.fdname}}</a>
        </div>
        <p id="sub_line" class="tj_box_1 clearfix" v-show="station_show_flag">
            <Progress :percent="statusbar" :stroke-width="5" status="active" v-show="statusShow"></Progress>
            <a href="javascript:;"
               v-for="(item1,index) in station_arr"
               :class="{active:station_active == index}"
               class="pt05"
               :id="item1.id"
               :data-sortType="'sort_sub_sta_'+index"
               @click="getHouseList($event)"
            >{{item1.fdname}}</a>
        </p>
    </div>

</template>

<script>
    export default {

        data (){
            return {

                statusbar: 0,
                statusShow: true,
                timer: null,

                lines: [],
                station_arr: [],

                line_active: 0,
                station_active: 0,

                station_show_flag: false, //默认电站不显示
            }
        },
        methods: {

            lineHide(){
                this.sub_show_flag = false; //二级车站隐藏
                $('.weizhi a').removeClass('active');
                $('#district_all').addClass('active');
            },

            stationInit(){
                $('#sub_line a').removeClass('active');
                $('#sub_line a:first-child').addClass('active');
            },

            //获取地铁线路
            getLine(){
                var _this = this;
                //调用区域查询接口，更新数据
                this.$http.post(
                    this.$api_ysapi + '/yhcms/web/lpjbxx/lpsubway.do',
                    {
//                      "parameters": {},
//                      "foreEndType": 2,
//                      "code": "90000301"
                    }
                ).then(function (res) {
                    var result = JSON.parse(res.bodyText);
                    if (result.success) {
                        _this.lines = result.data.subway;
                        var all_lines = {
                            id: "line_all",
                            fdname: "全部",
                            class: "noArrow"
                        }
                        _this.lines.unshift(all_lines);
                        _this.statusShow = false;
                    } else {
                        this.$Message.error(result.message);
                    }
                }, function (res) {
                    this.$Message.error('获取地铁线路失败');
                });
            },

            //获取车站名称
            getStation(e){
                var _this = this;

                $(e.target).addClass('active').siblings().removeClass('active');


                var emitObj = {
                    id: $(e.target).attr('id'),
                    name: $(e.target).text(),
                    sortType: $(e.target).attr('data-sortType')
                };
                this.$emit("refreshbizlines3", emitObj);


                if ($(e.target).attr('id') == 'line_all') {
                    this.station_show_flag = false;
                    if (!$(e.target).hasClass('tj_box_1')) {
                        $(e.target).parent().addClass('tj_box_1');
                    }

                } else {
                    //调用车站查询接口，更新数据

                    this.$http.post(
                        this.$api_ysapi + '/yhcms/web/lpjbxx/getLpSubwaystation.do',
                        {
                            "parameters": {
                                "line_id": $(e.target).attr('id')
                            },
                            "foreEndType": 2,
                            "code": "30000008"
                        }
                    ).then(function (res) {
                        var result = JSON.parse(res.bodyText);
                        if (result.success) {
                            _this.station_show_flag = true;
                            _this.station_arr = result.data.subway_station;
                            var all_station = {
                                id: "line_sta_all",
                                fdname: "全部",
                            }
                            _this.station_arr.unshift(all_station);

                            $(e.target).parent().removeClass('tj_box_1');
                        } else {
                            this.$Message.error(result.message);
                        }
                    }, function (res) {
                        this.$Message.error('获取车站失败');
                    });

                }
            },

            getHouseList(e){
                $(e.target).addClass('active').siblings().removeClass('active');

                var emitObj2 = {
                    id: $(e.target).attr('id'),
                    name: $(e.target).text(),
                    sortType: $(e.target).attr('data-sortType')
                };
                this.$emit("refreshbizlines4", emitObj2);
            }
        },

        mounted(){
            var _this = this;
            this.getLine(); //获取地铁线路

            _this.timer = setInterval(function () {
                _this.statusbar += 30;
                if (_this.statusbar >= 99) {
                    _this.statusbar = 99;
                    clearInterval(_this.timer);
                }
            }, 500);

        }
    }
</script>
